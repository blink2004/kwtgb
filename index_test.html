<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon"/>
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon"/>
    <title>Kyiv Weather Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.24.1.css">
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <!-- Telegram mini app Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- End of Telegram mini app Script -->

    <!-- jQuery Script -->
    <script type="text/javascript">
        // –û–±—ä—è–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const MIN_COUNT_SYMBOLS_FOR_REPORT_MSG = 5;
        const MAX_COUNT_SYMBOLS_FOR_REPORT_MSG = 255;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let userSettings = {
            'currentLang': 'ru'
        };

        const i18n = {
            'en' : [
                // {'':''},
                // {'':''},
                {'MIN_SYMBOLS': '–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã 5 —Å–∏–º–≤–æ–ª–æ–≤'},
                // {'':''},
            ],
            'ru' : [
                {
                    'OK_BTN': 'OK',
                    'ADD_BTN': '–î–æ–±–∞–≤–∏—Ç—å',
                    'CANCEL_BTN': '–û—Ç–º–µ–Ω–∏—Ç—å',
                    'MIN_COUNT_SYMBOLS_FOR_REPORT_MSG': '–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã 5 —Å–∏–º–≤–æ–ª–æ–≤',
                    'MAX_COUNT_SYMBOLS_FOR_REPORT_MSG': '–ü—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤',
                    'EVENT_TYPE': {
                        1: '–°–∏–Ω–∏–µ',
                        2: '–ó–µ–ª—ë–Ω—ã–µ',
                        3: '–°–æ–ª–Ω–µ—á–Ω–æ',
                        4: '–ë–ª–æ–∫-–ø–æ—Å—Ç',
                    },
                    'EVENT_TYPE_IS_NOT_SELECTED': '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è',
                    'REPORT_DESCRIPTION_TEXT_LENGTH_NOT_CORRECT': '–°–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ ' + MIN_COUNT_SYMBOLS_FOR_REPORT_MSG + ' –∏ –Ω–µ –±–æ–ª–µ–µ ' + MAX_COUNT_SYMBOLS_FOR_REPORT_MSG + ' —Å–∏–º–≤–æ–ª–æ–≤',
                }
            ],
            'ua' : []
        };

        var isAddNewMarketBtnClicked = false;
        var isSettingsBtnClicked = false;

        function setPressedBtn(el, status) {
            if ( status ) {
                $(el).css('background-color', 'lightgreen');
            } else {
                $(el).css('background-color', 'white');
            }
        }

        // $(document).ready(function() {
        $(function() {
            // –ü—Ä—è—á–µ–º –≤—Å—ë –ª–∏—à–Ω–µ–µ
            $('#reportInfoModal, #reportInfoDetailsPopup, #setMapMarkerHint, #settingsModalBox, #preloader, .spinner').hide();

            $("#selectedMarkerTypeDesc").text("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è");

            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä–∫–µ—Ä"
            $("#addNewMarkerBtn").on("click", function (e) {
                if ( isAddNewMarketBtnClicked ) {
                    setPressedBtn($(this), false);
                    $("#settingsBtn").show(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
                    $("#setMapMarkerHint").hide(); // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ –¥–µ–π—Å—Ç–≤–∏—è—Ö
                    Telegram.WebApp.MainButton.show(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É Telegram
                    Telegram.WebApp.SecondaryButton.hide(); // –°–∫—Ä—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∫–Ω–æ–ø–∫—É Telegram
                } else {
                    setPressedBtn($(this), true);
                    Telegram.WebApp.MainButton.setParams({ text: i18n[userSettings.currentLang][0].ADD_BTN });
                    Telegram.WebApp.SecondaryButton.setParams({ text: i18n[userSettings.currentLang][0].CANCEL_BTN });
                    $("#settingsBtn").hide(); // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
                    $("#setMapMarkerHint").show(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ –¥–µ–π—Å—Ç–≤–∏—è—Ö
                    $("#reportInfoDetailsPopup").hide(); // –°–∫—Ä—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ —Ç–æ—á–∫–∏, –µ—Å–ª–∏ –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞
                }
                isAddNewMarketBtnClicked = !isAddNewMarketBtnClicked; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Å—Ç–∞—Ç—É—Å –∫–Ω–æ–ø–∫–∏
            });

            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
            $("#settingsBtn").on("click", function(e) {
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ —ç—Ç–æ–≥–æ –ø—ã—Ç–∞–ª—Å—è –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –∏–ª–∏ –µ—â—ë —á—Ç–æ-—Ç–æ - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
                if ( isAddNewMarketBtnClicked ) {
                    e.preventDefault();
                    return;
                }

                // –ö–Ω–æ–ø–∫–∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–∂–µ –±—ã–ª–∞ –Ω–∞–∂–∞—Ç–∞ -> –≤—ã—Ö–æ–¥–∏–º, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å—ë
                if ( isSettingsBtnClicked ) {
                    setPressedBtn($(this), false);
                    $("#map").show();
                    $("#addNewMarkerBtn").show();
                    Telegram.WebApp.MainButton.show();
                } else {
                    setPressedBtn($(this), true);
                    $("#map").hide();
                    $("#addNewMarkerBtn").hide();
                    $("#reportInfoDetailsPopup").hide(); // –°–∫—Ä—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ —Ç–æ—á–∫–∏, –µ—Å–ª–∏ –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞
                    if ( Telegram.WebApp.MainButton.isVisible )
                        Telegram.WebApp.MainButton.hide();
                }
                isSettingsBtnClicked = !isSettingsBtnClicked;
            });

            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª –¥–∞–Ω–Ω—ã–µ
            // $("#reportInfoBoxSendReport, #sendReportBtn").on("click", function(e) {
            $("#sendReportBtn").on("click", function(e) {
                // window.navigator.vibrate(200);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã
                if ( $('input[name="event_type"]:checked').val() === undefined ) {
                    e.preventDefault();
                    Telegram.WebApp.showAlert(i18n[userSettings.currentLang][0].EVENT_TYPE_IS_NOT_SELECTED);

                    return false;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–∫–∞–∑–∞–Ω –ª–∏ —Ç–µ–∫—Å—Ç
                let reportDescriptionText = $('#reportDescription').val();
                if ( (reportDescriptionText.length < MIN_COUNT_SYMBOLS_FOR_REPORT_MSG) || (reportDescriptionText.length > MAX_COUNT_SYMBOLS_FOR_REPORT_MSG) ) {
                    e.preventDefault();
                    Telegram.WebApp.showAlert(i18n[userSettings.currentLang][0].REPORT_DESCRIPTION_TEXT_LENGTH_NOT_CORRECT);
                    $('#reportDescription').focus();

                    return false;
                }

                // $("#preloader, .spinner").fadeIn("slow");
                $("#preloader, .spinner").show();

                $.ajax({
                    method: 'POST',
                    url: '/api/markers/add',
                    data: {
                        event_type: $('input[name="event_type"]:checked').val(),
                        description: $('#reportDescription').val()
                    },
                    success: function(data, textStatus, jqXHR) {
                        Telegram.WebApp.showAlert("–°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ —Å–∫–æ—Ä–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ. –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∫–ª–∞–¥! üôå");
                        Telegram.WebApp.MainButton.show();
                        // alert("–°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ —Å–∫–æ—Ä–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ. –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∫–ª–∞–¥! üôå");
                    }
                }).fail(function( jqXHR, textStatus, errorThrown ) {
                    Telegram.WebApp.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –ø–æ–∑–∂–µ');
                    // alert('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –ø–æ–∑–∂–µ');
                }).done(function(data) {
                    console.log(data);
                });

                // alert("–°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ —Å–∫–æ—Ä–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ. –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∫–ª–∞–¥! üôå");
                // Telegram.WebApp.showAlert("–°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ —Å–∫–æ—Ä–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ. –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∫–ª–∞–¥! üôå");

                // $("#preloader, .spinner").fadeOut("slow");
                $("#preloader, .spinner").hide();

                map.removeLayer(marker);        // –£–¥–∞–ª—è–µ–º –º–∞—Ä–∫–µ—Ä, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É
                $("#reportInfoModal").hide();   // –ü—Ä—è—á–µ–º –ø–∞–Ω–µ–ª—å —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Ç–∫–µ
                $("#topPanel").show();          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–µ—Ä—Ö–Ω—é—é –ø–∞–Ω–µ–ª—å
                $("form")[0].reset();           // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
                $("#settingsBtn").show();       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
                $("#setMapMarkerHint").hide();  // –ü—Ä—è—á–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ –º–∞—Ä–∫–µ—Ä–∞
                $("#selectedMarkerTypeDesc").text("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è");

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–Ω–æ–ø–∫–∏ Telegram
                Telegram.WebApp.SecondaryButton.hide();
                Telegram.WebApp.MainButton.show();
            });

            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –æ—Ç–º–µ–Ω–∞ –¥–ª—è –æ–∫–Ω–∞ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            $("#reportInfoBoxCancelIconBtn, #reportInfoBoxCancelBtn").on("click", function(e) {
                e.preventDefault();

                map.removeLayer(marker);        // –£–¥–∞–ª—è–µ–º –º–∞—Ä–∫–µ—Ä, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É
                $("#reportInfoModal").hide();   // –ü—Ä—è—á–µ–º –ø–∞–Ω–µ–ª—å —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Ç–∫–µ
                $("#topPanel").show();          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–µ—Ä—Ö–Ω—é—é –ø–∞–Ω–µ–ª—å
                $("form")[0].reset();           // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
                $("#settingsBtn").show();       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
                $("#setMapMarkerHint").hide();  // –ü—Ä—è—á–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ –º–∞—Ä–∫–µ—Ä–∞
                $("#selectedMarkerTypeDesc").text("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è");

                Telegram.WebApp.MainButton.show();
            });

            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –∏–∫–æ–Ω–∫—É –ó–∞–∫—Ä—ã—Ç—å –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            $(".cancel-btn").on("click", function(e) {
                $(this).parent(".modal-window").hide();
                Telegram.WebApp.SecondaryButton.hide();
                Telegram.WebApp.MainButton.setParams({ text: i18n[userSettings.currentLang][0].ADD_BTN });
            });

            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –∏–∫–æ–Ω–∫—É –ù–∞–∑–∞–¥ –≤ –æ–∫–Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            $("#settingsModalBox > .back-btn").on("click", function(e) {
                // $(this).parent(".modal-window").hide();
                // $("#map").show();
                $("#settingsBtn").trigger("click");
                if ( !Telegram.WebApp.MainButton.isVisible ) {
                    Telegram.WebApp.MainButton.show();
                }
            });

            // –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —á–µ–∫–±–æ–∫—Å–∞
            $(".radiobox").on("click", function(e) {
                // alert($(this).find("img").prop("alt")); // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã!!!
                $("#selectedMarkerTypeDesc").text( $(this).find("img").prop("alt") );
            });

            // –ê–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–Ω—É—Ç—Ä–∏ jQuery
            (function(){
                // Init TWA
                Telegram.WebApp.ready();

                // Event occurs whenever theme settings are changed in the user's Telegram app (including switching to night mode).
                Telegram.WebApp.onEvent('themeChanged', function () {
                    document.documentElement.className = Telegram.WebApp.colorScheme;
                });

                Telegram.WebApp.onEvent('themeChanged', function () {
                    document.body.setAttribute('style', '--bg-color:' + Telegram.WebApp.backgroundColor);
                });

                // Show main button
                Telegram.WebApp.MainButton.setParams({
                    text: i18n[userSettings.currentLang][0].ADD_BTN
                });

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è –ø–æ –Ω–∞–∂–∞—Ç–∏—é –Ω–∞–∂–∞—Ç–∏—é
                Telegram.WebApp.MainButton.onClick( function(){
                    if ( isAddNewMarketBtnClicked ) {
                        Telegram.WebApp.showAlert('DEBUG: –ù–∞–∂–∞—Ç–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä')
                        $('#sendReportBtn').trigger('click');

                        return;
                    }

                    // Telegram.WebApp.showAlert('Main Button was clicked')
                    $("#addNewMarkerBtn").trigger("click");
                });

                Telegram.WebApp.SecondaryButton.onClick( function(){
                    if ( isAddNewMarketBtnClicked ) {
                        Telegram.WebApp.showAlert('DEBUG: –ù–∞–∂–∞—Ç–æ –¥–ª—è –æ—Ç–º–µ–Ω—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä')
                        $('#reportInfoBoxCancelBtn').trigger('click');

                        return;
                    }
                });

                Telegram.WebApp.MainButton.show();

                // Function to call showPopup API
                function showPopup() {
                    Telegram.WebApp.showPopup({
                        title: 'Title',
                        message: 'Some message',
                        buttons: [
                            {id: 'link', type: 'default', text: 'Open ton.org'},
                            {type: 'cancel'},
                        ]
                    }, function (btn) {
                        if (btn === 'link') {
                            Telegram.WebApp.openLink('https://ton.org/');
                        }
                    });
                };

                // Function to toggle main TWA button
                function toggleMainButton() {
                    if (Telegram.WebApp.MainButton.isVisible) {
                        Telegram.WebApp.MainButton.hide();
                    } else {
                        Telegram.WebApp.MainButton.show();
                    }
                };

                Telegram.WebApp.setHeaderColor('secondary_bg_color');

                // Telegram.WebApp.onEvent('viewportChanged', setViewportData);
            })(jQuery);

            placeMarkersOnMap(markersArr);
        });
    </script>
</head>
<body>
    <!-- Preloader -->
    <div id="preloader"></div>
<!--        <img src="./assets/preloader.gif" width="30" height="20" alt="Preloading image..." style="display: none;" />-->
    <div class="spinner"></div>


    <!-- Map -->
    <div id="map"></div>

    <!-- Top panel -->
    <div id="topPanel">
        <input type="button" class="btn-rounded" id="settingsBtn" value="" />
        <input type="button" class="btn-rounded" id="addNewMarkerBtn" value="" />
    </div>

    <span id="setMapMarkerHint">–£–∫–∞–∂–∏—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –∫–∞—Ä—Ç–µ</span>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏–∏ -->
    <div id="reportInfoModal" class="modal-window">
        <input type="button" class="cancel-btn btn-rounded" id="reportInfoBoxCancelIconBtn" value="" />
<!--        <input type="button" class="btn-rounded check-btn" id="reportInfoBoxSendReport" value="" />-->
        <div class="clear"></div>
        <form name="" method="post" enctype="multipart/form-data">
            <div>
                <div class="radiobox">
                    <input type="radio" id="sun" name="event_type" />
                    <label for="sun"><img src="./assets/sun.png" alt="–°–æ–ª–Ω–µ—á–Ω–æ" height="32" width="32" /></label>
                </div>
                <div class="radiobox">
                    <input type="radio" id="post" name="event_type" />
                    <label for="post"><img src="./assets/stop_control.png" alt="–ë–ª–æ–∫–ø–æ—Å—Ç" height="32" width="32" /></label>
                </div>
                <div class="radiobox">
                    <input type="radio" id="blue" name="event_type" />
                    <label for="blue"><img src="./assets/police_one.png" alt="–°–∏–Ω–∏–µ" height="32" width="32" /></label>
                </div>
                <div class="radiobox">
                    <input type="radio" id="green" name="event_type" />
                    <label for="green"><img src="./assets/icons8-soldiers-64.png" alt="–ó–µ–ª—ë–Ω—ã–µ" height="32" width="32" /></label>
                </div>
            </div>
            <div class="clear"></div>
            <div id="selectedMarkerTypeDesc">&nbsp;</div>
            <textarea name="description" id="reportDescription" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –Ω–µ –º–µ–Ω–µ–µ 5 —Å–∏–º–≤–æ–ª–æ–≤"></textarea><br />
<!--            <input type="file" name="media" /><br /><br />-->
<!--            <input type="submit" name="save" value="Save" />-->
            <button id="reportInfoBoxCancelBtn">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn-ok" id="sendReportBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
        </form>
    </div>

    <!-- Marker tooltip -->
    <div id="reportInfoDetailsPopup" class="modal-window">
        <input type="button" class="cancel-btn btn-rounded" id="" value="" />
<!--        <table>
            <tr>
                <td colspan="2">
                    <span class="icon"><img src="assets/icons8-soldiers-64.png" alt="–ó–µ–ª—ë–Ω—ã–µ" width="32" height="32" /></span>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="time">11:57</span>
                </td>
                <td>
                    <span class="status">–ó–µ–ª—ë–Ω—ã–µ</span>
                </td>
            </tr>
        </table>-->
        <table>
            <tr>
                <td>
                    <span class="icon"><img src="assets/icons8-soldiers-64.png" alt="–ó–µ–ª—ë–Ω—ã–µ" width="32" height="32" /></span>
                </td>
                <td>
                    <div class="time">11:57</div>
                    <div class="status">–ó–µ–ª—ë–Ω—ã–µ</div>
                </td>
            </tr>
        </table>
        <div class="description">2 —Å–∏–Ω–∏—Ö, 2 –∑–µ–ª—ë–Ω—ã—Ö. –ì—É–ª—è–ª–∏ –ø–æ –Ω–∞–±–µ—Ä–µ–∂–Ω–æ–π</div>
        <div id="reportInfoDetailsDescription"></div>
        <div id="reportInfoDetailsMedia"></div>
        <div id="reportInfoDetailsPopupRatingBlock">
            <button class="btn-rounded like"></button>
            <span id="rating">5</span>
            <button class="btn-rounded dislike"></button>
        </div>
    </div>

    <!-- –û–∫–Ω–æ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div id="settingsModalBox" class="modal-window">
<!--        <input type="button" class="cancel-btn btn-rounded" id="" value="" />-->
        <button class="back-btn"><</button>
        <span class="h2">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
        <div>
            –ë—É–¥—É—Ç –ø–æ–∑–∂–µ...
        </div>
    </div>


    <!-- Map Script -->
    <script type="text/javascript">
        var markersArr = [
            {
                'id': 2154181354,
                'time': '6:55',
                'type': 4,
                'lat': 50.571389,
                'lng': 30.490361,
                'rating': -2,
                'myReaction': 'l',
                'desc': 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin non luctus ipsum. Praesent fringilla libero sapien, ut porttitor est efficitur ut. Cras convallis gravida nisl sit amet pulvinar. Morbi in blandit ipsum. Aliquam porta urna vel ante consectetur tincidunt',
                'media': [
                    {
                        'typeOfMedia': 1,
                        'mediaUrl': ''
                    }
                ],
                'comments': [
                    {
                        'id': 513435435,
                        'userPhoto': '',
                        'userName': '',
                        'text': '',
                    }
                ]
            },
            {
                'id': 2154181354,
                'time': '12:57',
                'type': 2,
                'lat': 50.455683,
                'lng': 30.445903,
                'rating': 0,
                'myReaction': 'd',
                'desc': 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin non luctus ipsum. Praesent fringilla libero sapien, ut porttitor est efficitur ut. Cras convallis gravida nisl sit amet pulvinar. Morbi in blandit ipsum. Aliquam porta urna vel ante consectetur tincidunt',
                'media': [
                    {
                        'typeOfMedia': 1,
                        'mediaUrl': ''
                    }
                ],
                'comments': [
                    {
                        'id': 513435435,
                        'userPhoto': '',
                        'userName': '',
                        'text': '',
                    }
                ]
            },
            {
                'id': 2154181354,
                'time': '17:14',
                'type': 3,
                'lat': 50.401146,
                'lng': 30.634612,
                'rating': 8,
                'myReaction': '',
                'desc': 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin non luctus ipsum. Praesent fringilla libero sapien, ut porttitor est efficitur ut. Cras convallis gravida nisl sit amet pulvinar. Morbi in blandit ipsum. Aliquam porta urna vel ante consectetur tincidunt',
                'media': [],
                'comments': []
            }
        ];

        var map = L.map('map').setView([50.4447569069039, 30.54741427671182], 10);

        var marker;

        var IconClass = L.Icon.extend({
            options: {
                shadowUrl:    'assets/icon_shadow_32.png',
                iconSize:     [32, 32],
                shadowSize:   [32, 20],
                iconAnchor:   [16, 32],
                shadowAnchor: [0, 16],
                popupAnchor:  [0, -32]
            }
        });

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –º–∞—Ä–∫–µ—Ä–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
        const eventAdditionalProps = {
            1: {
                'iconSrc': 'assets/police_one.png',
            },
            2: {
                'iconSrc': 'assets/icons8-soldiers-64.png',
            },
            3: {
                'iconSrc': 'assets/sun.png',
            },
            4: {
                'iconSrc': 'assets/stop_control.png',
            },
        };

        // –ö–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ —Å–æ–±—ã—Ç–∏–π
        const markerIconsArr = {
            1: new IconClass({iconUrl: eventAdditionalProps[1].iconSrc}),
            2: new IconClass({iconUrl: eventAdditionalProps[2].iconSrc}),
            3: new IconClass({iconUrl: eventAdditionalProps[3].iconSrc}),
            4: new IconClass({iconUrl: eventAdditionalProps[4].iconSrc})
        };

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

/*        var circle = L.circle([50.511243, 30.513486], {
            color: 'red',
            alt: "Test",
            fillColor: '#f03',
            fillOpacity: 0.5,
            radius: 250
        })*/
        // .bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup()
        // .bindTooltip("<b>Hello world!</b><br>I am a popup.")
/*        .on("click", function(e) {
            $("#rating").addClass("font-green");
            $("#reportInfoDetailsPopup").show();
            map.panTo(e.latlng);
        })
        .addTo(map);*/

        /**
         * –†–∞–∑–º–µ—Å—Ç–∏—Ç—å —Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
         *
         * @param markersArr
         */
        function placeMarkersOnMap(markersArr) {
            for (let i = 0; i < markersArr.length; i++) {
                let item = L.marker([markersArr[i].lat, markersArr[i].lng], {icon: markerIconsArr[markersArr[i].type]})
                .on("click", function(e) {
                    $("#reportInfoDetailsPopup").hide();
                    $("#reportInfoDetailsPopup .icon > img").attr('src', eventAdditionalProps[markersArr[i].type].iconSrc);
                    $("#reportInfoDetailsPopup .time").text(markersArr[i].time);
                    $("#reportInfoDetailsPopup .status").text(i18n[userSettings.currentLang][0].EVENT_TYPE[markersArr[i].type]);
                    $("#reportInfoDetailsPopup .description").text(markersArr[i].desc);

                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±–ª–æ–∫ —Ä–µ–π—Ç–∏–Ω–≥
                    $("#rating").removeClass("font-normal font-green font-red");
                    if ( markersArr[i].rating > 0) {
                        $("#rating").addClass("font-green");
                    } else {
                        if ( markersArr[i].rating < 0 ) {
                            $("#rating").addClass("font-red");
                        } else {
                            $("#rating").addClass("font-normal");
                        }
                    }
                    $("#rating").text(markersArr[i].rating);

                    $("#reportInfoDetailsPopup").show();
                    map.panTo(e.latlng);

                    Telegram.WebApp.MainButton.hide();
                    Telegram.WebApp.SecondaryButton.hide();

                    // Show Telegram buttons
                    /*Telegram.WebApp.MainButton.setParams({
                        text: '–ê–∫—Ç—É–∞–ª—å–Ω–æ'
                    });
                    Telegram.WebApp.MainButton.show();

                    Telegram.WebApp.SecondaryButton.setParams({
                        text: '–ù–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ'
                    });
                    Telegram.WebApp.SecondaryButton.show();*/
                })
                .addTo(map);
            }
        }

        function onMapClick(e) {
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–∞–ª –Ω–∞ –∫–∞—Ä—Ç—É - –≤—ã—Ö–æ–¥–∏–º
            if ( !isAddNewMarketBtnClicked )
                return false;

            marker = new L.marker(e.latlng, {draggable: 'true'});
            marker.on('dragend', function (event) {
                var marker = event.target;
                var position = marker.getLatLng();
                marker.setLatLng(new L.LatLng(position.lat, position.lng), {draggable: 'true'});
                map.panTo(new L.LatLng(position.lat, position.lng))
            });
            map.addLayer(marker); // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ

            // –ü—Ä—è—á–µ–º –≤–µ—Ä—Ö–Ω—é—é –ø–∞–Ω–µ–ª—å —Å –∫–Ω–æ–ø–∫–∞–º–∏
            $("#topPanel").hide();

            // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª —ç–∫—Ä–∞–Ω–∞ –ø–æ–¥ –æ–ø–∏—Å–∞–Ω–∏–µ
            $("#reportInfoModal").show();

            map.panTo(marker.getLatLng()); // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –ø–æ —Å–µ—Ä–µ–¥–∏–Ω–µ –º–µ—Ç–∫–∏

            $("#setMapMarkerHint").hide(); // –ü—Ä—è—á–µ–º –Ω–∞–¥–ø–∏—Å—å –æ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ —Ç–æ—á–∫–∏

            isAddNewMarketBtnClicked = false;
            setPressedBtn("#addNewMarkerBtn", false);
        };

        map.on('click', onMapClick);
    </script>
    <!-- End of Map Script -->

    <!-- Eruda is console for mobile browsers -->
<!--    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>-->

    <!-- Unit tests block -->
    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
    <link rel="stylesheet" href="css/qunit-dark-theme.css" />
    <link rel="stylesheet" href="css/test.css" />
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,500,600,700' rel='stylesheet' >
    <script src="https://code.jquery.com/qunit/qunit-2.24.1.js"></script>
    <script type="text/javascript" src="js/tests.js"></script>
    <!-- End of Unit tests block -->

</body>
</html>