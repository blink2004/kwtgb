<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon"/>
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon"/>
    <title>Kyiv Weather Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="style.css" />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <!-- Telegram mini app Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // Init TWA
        Telegram.WebApp.ready();

        // Event occurs whenever theme settings are changed in the user's Telegram app (including switching to night mode).
        Telegram.WebApp.onEvent('themeChanged', function () {
            document.documentElement.className = Telegram.WebApp.colorScheme;
        });

        // Show main button
        Telegram.WebApp.MainButton.setParams({
            text: 'Main Button'
        });
        Telegram.WebApp.MainButton.onClick(function () {
            Telegram.WebApp.showAlert('Main Button was clicked')
        });
        Telegram.WebApp.MainButton.show();

        // Function to call showPopup API
        function showPopup() {
            Telegram.WebApp.showPopup({
                title: 'Title',
                message: 'Some message',
                buttons: [
                    {id: 'link', type: 'default', text: 'Open ton.org'},
                    {type: 'cancel'},
                ]
            }, function (btn) {
                if (btn === 'link') {
                    Telegram.WebApp.openLink('https://ton.org/');
                }
            });
        };

        // Function to toggle main TWA button
        function toggleMainButton() {
            if (Telegram.WebApp.MainButton.isVisible) {
                Telegram.WebApp.MainButton.hide();
            } else {
                Telegram.WebApp.MainButton.show();
            }
        };

        Telegram.WebApp.setHeaderColor('secondary_bg_color');

        // Telegram.WebApp.onEvent('viewportChanged', setViewportData);

        Telegram.WebApp.onEvent('themeChanged', function () {
            document.body.setAttribute('style', '--bg-color:' + Telegram.WebApp.backgroundColor);
        });

    </script>
    <!-- End of Telegram mini app Script -->

    <!-- jQuery Script -->
    <script type="text/javascript">
        const i18n = {
            'en' : [
                // {'':''},
                // {'':''},
                {'MIN_SYMBOLS': '–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã 5 —Å–∏–º–≤–æ–ª–æ–≤'},
                // {'':''},
            ],
            'ru' : [
                {'MIN_SYMBOLS': '–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã 5 —Å–∏–º–≤–æ–ª–æ–≤'}
            ],
            'ua' : []
        };

        var isAddNewMarketBtnClicked = false;
        var isSettingsBtnClicked = false;

        function setPressedBtn(el, status) {
            if ( status ) {
                $(el).css('background-color', 'lightgreen');
            } else {
                $(el).css('background-color', 'white');
            }
        }

        // $(document).ready(function() {
        $(function() {
            // –ü—Ä—è—á–µ–º –≤—Å—ë –ª–∏—à–Ω–µ–µ
            $("#reportInfoModal, #reportInfoDetailsPopup, #setMapMarkerHint, #preloader, .spinner").hide();

            $("#selectedMarkerTypeDesc").text("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è");

            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä–∫–µ—Ä"
            $("#addNewMarkerBtn").on("click", function (e) {
                if ( isAddNewMarketBtnClicked ) {
                    setPressedBtn($(this), false);
                    $("#settingsBtn").show(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
                    $("#setMapMarkerHint").hide();
                } else {
                    setPressedBtn($(this), true);
                    $("#settingsBtn").hide(); // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
                    $("#setMapMarkerHint").show();
                    $("#reportInfoDetailsPopup").hide(); // –°–∫—Ä—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ —Ç–æ—á–∫–∏, –µ—Å–ª–∏ –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞
                }
                isAddNewMarketBtnClicked = !isAddNewMarketBtnClicked; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Å—Ç–∞—Ç—É—Å –∫–Ω–æ–ø–∫–∏
            });

            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
            $("#settingsBtn").on("click", function(e) {
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –∏–ª–∏ –µ—â—ë —á—Ç–æ-—Ç–æ - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
                if ( isAddNewMarketBtnClicked ) {
                    e.preventDefault();
                    return;
                }

                if ( isSettingsBtnClicked ) {
                    setPressedBtn($(this), false);
                    $("#map").show();
                    $("#addNewMarkerBtn").show();
                } else {
                    setPressedBtn($(this), true);
                    $("#map").hide();
                    $("#addNewMarkerBtn").hide();
                    $("#reportInfoDetailsPopup").hide(); // –°–∫—Ä—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ —Ç–æ—á–∫–∏, –µ—Å–ª–∏ –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞
                }
                isSettingsBtnClicked = !isSettingsBtnClicked;
            });

            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª –¥–∞–Ω–Ω—ã–µ
            // $("#reportInfoBoxSendReport, #sendReportBtn").on("click", function(e) {
            $("#sendReportBtn").on("click", function(e) {
                // window.navigator.vibrate(200);

                // $("#preloader, .spinner").fadeIn("slow");
                $("#preloader, .spinner").show();

                // alert("–°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ —Å–∫–æ—Ä–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ. –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∫–ª–∞–¥! üôå");
                Telegram.WebApp.showAlert("–°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ —Å–∫–æ—Ä–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ. –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∫–ª–∞–¥! üôå");

                // $("#preloader, .spinner").fadeOut("slow");
                $("#preloader, .spinner").hide();

                map.removeLayer(marker);        // –£–¥–∞–ª—è–µ–º –º–∞—Ä–∫–µ—Ä, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É
                $("#reportInfoModal").hide();   // –ü—Ä—è—á–µ–º –ø–∞–Ω–µ–ª—å —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Ç–∫–µ
                $("#topPanel").show();          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–µ—Ä—Ö–Ω—é—é –ø–∞–Ω–µ–ª—å
                $("form")[0].reset();           // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
                $("#settingsBtn").show();       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
                $("#setMapMarkerHint").hide();  //
                $("#selectedMarkerTypeDesc").text("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è");
            });

            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –æ—Ç–º–µ–Ω–∞ –¥–ª—è –æ–∫–Ω–∞ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            $("#reportInfoBoxCancelIconBtn, #reportInfoBoxCancelBtn").on("click", function(e) {
                map.removeLayer(marker);        // –£–¥–∞–ª—è–µ–º –º–∞—Ä–∫–µ—Ä, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É
                $("#reportInfoModal").hide();   // –ü—Ä—è—á–µ–º –ø–∞–Ω–µ–ª—å —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Ç–∫–µ
                $("#topPanel").show();          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–µ—Ä—Ö–Ω—é—é –ø–∞–Ω–µ–ª—å
                $("form")[0].reset();           // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
                $("#settingsBtn").show();       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
                $("#setMapMarkerHint").hide();  //
                $("#selectedMarkerTypeDesc").text("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è");
            });

            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –∏–∫–æ–Ω–∫—É –ó–∞–∫—Ä—ã—Ç—å –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            $(".cancel-btn").on("click", function(e) {
                $(this).parent(".modal-window").hide();
            });

            $("#settingsModalBox > .back-btn").on("click", function(e) {
                // $(this).parent(".modal-window").hide();
                // $("#map").show();
                $("#settingsBtn").trigger("click");
            });

            // –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —á–µ–∫–±–æ–∫—Å–∞
            $(".radiobox").on("click", function(e) {
                // alert($(this).find("img").prop("alt")); // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã!!!
                $("#selectedMarkerTypeDesc").text( $(this).find("img").prop("alt") );
            });
        });
    </script>
</head>
<body>
    <!-- Preloader -->
    <div id="preloader"></div>
<!--        <img src="./assets/preloader.gif" width="30" height="20" alt="Preloading image..." style="display: none;" />-->
    <div class="spinner"></div>


    <!-- Map -->
    <div id="map"></div>

    <!-- Top panel -->
    <div id="topPanel">
        <input type="button" class="btn-rounded" id="settingsBtn" value="" />
        <input type="button" class="btn-rounded" id="addNewMarkerBtn" value="" />
    </div>

    <span id="setMapMarkerHint">–£–∫–∞–∂–∏—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –∫–∞—Ä—Ç–µ</span>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏–∏ -->
    <div id="reportInfoModal" class="modal-window">
        <input type="button" class="cancel-btn btn-rounded" id="reportInfoBoxCancelIconBtn" value="" />
<!--        <input type="button" class="btn-rounded check-btn" id="reportInfoBoxSendReport" value="" />-->
        <div class="clear"></div>
        <form name="" method="post" enctype="multipart/form-data" action="" onsubmit="return false;">
            <div>
                <div class="radiobox">
                    <input type="radio" id="sun" name="radio"/>
                    <label for="sun"><img src="./assets/sun.png" alt="–°–æ–ª–Ω–µ—á–Ω–æ" height="32" width="32" /></label>
                </div>
                <div class="radiobox">
                    <input type="radio" id="post" name="radio"/>
                    <label for="post"><img src="./assets/stop_control.png" alt="–ë–ª–æ–∫–ø–æ—Å—Ç" height="32" width="32" /></label>
                </div>
                <div class="radiobox">
                    <input type="radio" id="police" name="radio"/>
                    <label for="police"><img src="./assets/police_one.png" alt="–°–∏–Ω–∏–µ" height="32" width="32" /></label>
                </div>
                <div class="radiobox">
                    <input type="radio" id="danger" name="radio"/>
                    <label for="danger"><img src="./assets/icons8-soldiers-64.png" alt="–ó–µ–ª—ë–Ω—ã–µ" height="32" width="32" /></label>
                </div>
            </div>
            <div class="clear"></div>
            <div id="selectedMarkerTypeDesc">&nbsp;</div>
            <textarea name="description" id="reportDescription" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –Ω–µ –º–µ–Ω–µ–µ 5 —Å–∏–º–≤–æ–ª–æ–≤"></textarea><br />
<!--            <input type="file" name="media" /><br /><br />-->
<!--            <input type="submit" name="save" value="Save" />-->
            <button id="reportInfoBoxCancelBtn">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn-ok" id="sendReportBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
        </form>
    </div>

    <!-- Marker tooltip -->
    <div id="reportInfoDetailsPopup" class="modal-window">
        <input type="button" class="cancel-btn btn-rounded" id="" value="" />
        <span class="time">11:57</span>
        <span class="icon"><img src="assets/icons8-soldiers-64.png" alt="–ó–µ–ª—ë–Ω—ã–µ" width="32" height="32" /></span>
        <span class="status">–ó–µ–ª—ë–Ω—ã–µ</span>
        <div class="description">2 —Å–∏–Ω–∏—Ö, 2 –∑–µ–ª—ë–Ω—ã—Ö. –ì—É–ª—è–ª–∏ –ø–æ –Ω–∞–±–µ—Ä–µ–∂–Ω–æ–π</div>
        <div id="reportInfoDetailsDescription"></div>
        <div id="reportInfoDetailsMedia"></div>
        <div id="reportInfoDetailsPopupRatingBlock">
            <button class="btn-rounded like"></button>
<!--            <span id="rating">5</span>-->
            <button class="btn-rounded dislike"></button>
        </div>
    </div>

    <!-- –û–∫–Ω–æ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div id="settingsModalBox" class="modal-window">
<!--        <input type="button" class="cancel-btn btn-rounded" id="" value="" />-->
        <button class="back-btn"><</button>
        <span class="h2">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
        <div>
            –ë—É–¥—É—Ç –ø–æ–∑–∂–µ...
        </div>
    </div>


    <!-- Map Script -->
    <script type="text/javascript">
        var markersArr = [
            {
                'id': 2154181354,
                'time': '11:55',
                'type': 1,
                'lat': 50.02153,
                'lng': 30.15654,
                'rating': 4,
                'desc': 'asfjkljasdklfj alksdjf lkajsd flkaj sdflkajsdflk; j',
                'media': [
                    {
                        'typeOfMedia': 1,
                        'mediaUrl': ''
                    }
                ],
                'comments': [
                    {
                        'id': 513435435,
                        'userPhoto': '',
                        'userName': '',
                        'text': '',
                    }
                ]
            },
            {
                'id': 2154181354,
                'time': '11:55',
                'type': 2,
                'lat': 50.02153,
                'lng': 30.15654,
                'rating': 8,
                'desc': 'asfjkljasdklfj alksdjf lkajsd flkaj sdflkajsdflk; j',
                'media': [
                    {
                        'typeOfMedia': 1,
                        'mediaUrl': ''
                    }
                ],
                'comments': [
                    {
                        'id': 513435435,
                        'userPhoto': '',
                        'userName': '',
                        'text': '',
                    }
                ]
            },
            {
                'id': 2154181354,
                'time': '11:55',
                'type': 3,
                'lat': 50.02153,
                'lng': 30.15654,
                'rating': 5,
                'desc': 'asfjkljasdklfj alksdjf lkajsd flkaj sdflkajsdflk; j',
                'media': [],
                'comments': []
            }
        ];

        var map = L.map('map').setView([50.4447569069039, 30.54741427671182], 12);

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        var circle = L.circle([50.511243, 30.513486], {
            color: 'red',
            alt: "Test",
            fillColor: '#f03',
            fillOpacity: 0.5,
            radius: 250
        })
        // .bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup()
        // .bindTooltip("<b>Hello world!</b><br>I am a popup.")
        .on("click", function(e) {
            $("#rating").addClass("font-green");
            $("#reportInfoDetailsPopup").show();
            map.panTo(e.latlng);
        })
        .addTo(map);

        /**
         * –†–∞–∑–º–µ—Å—Ç–∏—Ç—å —Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
         *
         * @param markersArr
         */
        function placeMarkersOnMap(markersArr) {
            for (let i = 0; i < markersArr.length; i++) {

            }
        }

        function onMapClick(e) {
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–∞–ª –Ω–∞ –∫–∞—Ä—Ç—É - –≤—ã—Ö–æ–¥–∏–º
            if ( !isAddNewMarketBtnClicked )
                return false;

            marker = new L.marker(e.latlng, {draggable: 'true'});
            marker.on('dragend', function (event) {
                var marker = event.target;
                var position = marker.getLatLng();
                marker.setLatLng(new L.LatLng(position.lat, position.lng), {draggable: 'true'});
                map.panTo(new L.LatLng(position.lat, position.lng))
            });
            map.addLayer(marker); // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ

            // –ü—Ä—è—á–µ–º –≤–µ—Ä—Ö–Ω—é—é –ø–∞–Ω–µ–ª—å —Å –∫–Ω–æ–ø–∫–∞–º–∏
            $("#topPanel").hide();

            // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª —ç–∫—Ä–∞–Ω–∞ –ø–æ–¥ –æ–ø–∏—Å–∞–Ω–∏–µ
            $("#reportInfoModal").show();

            map.panTo(marker.getLatLng()); // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –ø–æ —Å–µ—Ä–µ–¥–∏–Ω–µ –º–µ—Ç–∫–∏

            $("#setMapMarkerHint").hide(); // –ü—Ä—è—á–µ–º –Ω–∞–¥–ø–∏—Å—å –æ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ —Ç–æ—á–∫–∏

            isAddNewMarketBtnClicked = false;
            setPressedBtn("#addNewMarkerBtn", false);
        };

        map.on('click', onMapClick);
    </script>
    <!-- End of Map Script -->

    <!-- Eruda is console for mobile browsers -->
<!--    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>-->

</body>
</html>